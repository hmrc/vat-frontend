@*
 * Copyright 2018 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import connectors.models.VatModel
@import config.FrontendAppConfig
@import models.requests.AuthenticatedRequest
@import models.Helper

@(vatModel: VatModel, currentUrl: String, appConfig: FrontendAppConfig, helper: Helper)(serviceInfoContent: Html)(implicit request: Request[_], messages: Messages, authRequest: AuthenticatedRequest[_])


@sidebarLinks = {
  <section class="section--blue-top">
    <nav role="navigation">
      <div id="vat-vrn" class="subsection flush--top">
        <h3>@messages("subpage.sidebar.vrn")</h3>
        <p class="font-xsmall">@authRequest.vatDecEnrolment.vrn</p>
      </div>

      <div class="subsection" id="filing-for-vat">
        <h3>@messages("subpage.sidebar.when_you_file_for_vat")</h3>
        <ul class="sidebar__list">

          @vatModel.calendar match {
            case Some(calendar) => {
              <li>
                <p class="font-xsmall flush--bottom">@messages("vat.you.file.partial") @messages(helper.vatPaymentIntervalKey(calendar)).</p>
              </li>
              @if(calendar.isMonthly) {
                <li class="font-xsmall">
                  <a id="change-to-quarterly" href=@appConfig.getGovUrl("vat.annualScheme")
                     data-journey-click="VatSubpage:click:ChangeToQuarterlyFiling">@messages("vat.change.to.quarterly.filing.link.text")</a>
                </li>
              }
              @if(calendar.isQuarterly) {
                <li class="font-xsmall">
                  <a id="change-to-monthly" href="@appConfig.getPortalUrl("vatChangetoMonthlyFilings")(Some(authRequest.vatDecEnrolment))"
                  data-journey-click="VatSubpage:click:FileMonthlyOrChangeFilingMonths"
                  data-sso="false">@messages("subpage.sidebar.file_monthly_or_change_filing_months")</a>
                </li>
              }
              @if(calendar.isAnnual) {
                <li class="font-xsmall">
                  <a id="leave-annual-scheme" href=@appConfig.getGovUrl("vat.joinAnnualScheme")
                     data-journey-click="VatSubpage:click:LeaveTheVatAnnualAccountingScheme">@messages("vat.leave.annual.filing.link.text")</a>
                  @messages("vat.leave.annual.filing.text.2")
                </li>
              }
              @if(!calendar.isAnnual) {
                <li class="font-xsmall">
                  <a id="change-to-annual" href=@appConfig.getGovUrl("annualScheme")
                     data-journey-click="VatSubpage:click:ChangeToAnnualFiling">@messages("subpage.sidebar.change_to_annual_filing")</a>
                </li>
              }
            }
            case _ => {
              <li>
                <p class="font-xsmall">@messages("subpage.sidebar.interval.unavailable.text") <br>
                  @messages("subpage.sidebar.interval.unavailable.text.2") <a id="your-vat-certificate" href="@appConfig.getPortalUrl("vatCertificate")(Some(authRequest.vatDecEnrolment))"
                  data-sso="false">@messages("subpage.sidebar.certificate.link.text")</a>.
                </p>
              </li>
            }
          }
        </ul>
      </div>


      <div id="help-with-tax" class="subsection">
        <h3>@messages("subpage.sidebar.moreoptions")</h3>
        <ul class="sidebar__list">
          <li>
            <a id="get-filing-reminders" class="font-xsmall" href="@appConfig.customsUrl("eprompt/httpssl/changeVatEmailAddress.do")"
            data-journey-click="VatSubpage:click:GetFilingReminders"
            data-sso="client">@messages("subpage.sidebar.details.get.filing.reminders.link.text")</a>
          </li>
          <li>
            <a id="view-vat-certificate" class="font-xsmall" href="@appConfig.getPortalUrl("vatCertificate")(Some(authRequest.vatDecEnrolment))"
            data-journey-click="VatSubpage:click:ViewVatCertificate"
            data-sso="false">@messages("subpage.sidebar.details.view.vat.certificate.link.text")</a>
          </li>
          <li>
            <a id="paying-by-direct-debit" class="font-xsmall"
               data-journey-click="VatSubpage:click:DirectDebits"
               href="@appConfig.getHelpAndContactUrl("vat/direct-debit")">@messages("subpage.sidebar.direct.debit.text")</a>
          </li>
          <li>
            <a id="add-vat-service" class="font-xsmall"
               data-journey-click="VatSubpage:click:AddService"
               href="@appConfig.getBusinessAccountUrl("addVat")">@messages("subpage.sidebar.add.vat.service.text")</a>
          </li>
          <li>
            <a id="help-and-contact" class="font-xsmall"
               data-journey-click="VatSubpage:click:HelpAndContact"
               href="@appConfig.getHelpAndContactUrl("vat")">@messages("subpage.sidebar.help.text")</a>
          </li>
          <li>
            <a id="deregister-vat" class="font-xsmall"
               data-journey-click="VatSubpage:click:DeregisterVat"
               href="@controllers.routes.DeregisterController.onPageLoad">@messages("deregister.title")</a>
          </li>
          <li>
            <a id="more-vat-options" class="bold-xsmall" href="@appConfig.getPortalUrl("vatAccountDetails")(Some(authRequest.vatDecEnrolment))"
            data-journey-click="VatSubpage:click:MoreOptions"
            data-sso="false">@messages("subpage.sidebar.more")</a>
          </li>
        </ul>
      </div>

    </nav>
  </section>
}

@*
TODO - Put warnings and sidebarClasses in the main template or find some other way of using them as before
*@

@content_header = {
  <header>
    <h1 id="page-title" class="bold-large flush--top">@messages("subpage.title")</h1>
  </header>

}

@main_template(title = messages("subpage.title"), appConfig = appConfig, sidebarLinks = Some(sidebarLinks), bodyClasses = Some("business-tax"), contentHeader=Some(content_header), serviceInfoContent = serviceInfoContent) {
  <div class="notice" id="payments-notice">
    <i class="icon icon-information">
      <span class="visuallyhidden">Information</span>
    </i>
    <p>
      <strong>
        @Messages("subpage.paymentsnotice")
      </strong>
    </p>
  </div>

  <ul class="action-list list-noborder">
    @helper.renderAccountSummary(vatModel, currentUrl, showSubpageLink = false)
  </ul>

  <div class="subsection">
    <h2>@messages("submitted.returns.heading")</h2>
    <ul>
      <li>
        <a id="view-submitted-returns" href="@appConfig.getPortalUrl("vatSubmittedReturns")(Some(authRequest.vatDecEnrolment))"
          data-journey-click="VatSubpage:click:ViewSubmittedReturn"
          data-sso="false">@messages("vat.view.submitted.returns.link.text")
        </a>
      </li>
      <li>
        <a id="correct-a-mistake" href="@appConfig.getHelpAndContactUrl("vat/correct-a-mistake")"
          data-journey-click="VatSubpage:click:CorrectAMistake">@messages("vat.view.correct.mistake.link.text")
        </a>
      </li>
    </ul>
  </div>

  <div class="subsection">
    <h2>@messages("vat.payments.and.repayments")</h2>
    <ul>
      <li>
        <a id="view-payments-and-repayments" href="@appConfig.getPortalUrl("vatPaymentsAndRepayments")(Some(authRequest.vatDecEnrolment))"
          data-journey-click="VatSubpage:click:ViewPaymentsAndRepayments"
          data-sso="false">@messages("vat.view.payments.repayments.link.text")
        </a>
      </li>

      <li>
        @messages("vat.repayments.account.stated.text")
        <a id="vat-certificate" href="@appConfig.getPortalUrl("vatCertificate")(Some(authRequest.vatDecEnrolment))"
          data-journey-click="VatSubpage:click:ViewRepaymentsOnVatCertificate"
          data-sso="false">@messages("vat.certificate.link.text")
        </a>.
        <a id="change-repayments-account" href="@appConfig.getPortalUrl("vatChangeRepaymentsAccount")(Some(authRequest.vatDecEnrolment))"
          data-journey-click="VatSubpage:click:ChangeYourRepaymentsAccount"
          data-sso="false">@messages("vat.change.repayments.account.link.text")
        </a>
      </li>
    </ul>
  </div>


}